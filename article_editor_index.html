<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Site Manager</title>
        <meta name="viewport" content="initial-scale=1, maximum-scale=1">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="google" value="notranslate">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <link rel="shortcut icon" href="img/favicon.ico"/>
        <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
        <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css"/>
        <link rel="stylesheet" href="css/bootcards-desktop.min.css" type="text/css"/>
        <script src="js/jquery-2.1.1.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/bootcards.js"></script>
        <script src="js/fastclick.min.js"></script>
        <script src="js/raphael-min.js"></script>
        <script src="js/morris.min.js"></script>
        <script src="js/config.js"></script>
        <script src="js/helper.js"></script>
    </head>

    <body>
        <!--Menu Top-->
        <div class="navbar navbar-default navbar-fixed-top" role="navigation" id="menu-top">
            <div class="container">
                <!--Title(Desktop)-->
                <img src="img/favicon.ico" style="height: 45px;width: 41px; float: left;padding: 10px 5px 5px 5px;">
                <a class="navbar-brand" title="Electrionic Lettter">N-Portal</a>
            </div>
        </div>

        <!--Content-->
        <div class="container bootcards-container push-right">
            <div class="row">
                <div class="col-sm-8 bootcards-cards" id="content-left">
                    <!--Article-->
                    <div class="panel panel-default" style="margin-top: 10px;">
                        <div class="panel-heading clearfix">
                            <h3 class="panel-title pull-left" id="progress-info-article">Edit Artikel</h3>
                            <div class="btn-group pull-right">
                                <a class="btn btn-success" href="javascript:void(0)" id="doUpdateArticle">
                                    <i class="fa fa-floppy-o"></i>
                                    <span>Simpan</span>
                                </a>
                            </div>
                        </div>
                        <div class="list-group">
                            <div class="list-group-item">
                                <label class="list-group-item-text">Judul</label>
                                <div class="list-group-item-heading">
                                    <input type="text" name="title" id="title" class="form-control">
                                </div>
                            </div>
                            <div class="list-group-item" style="border: 0px;">
                                <label class="list-group-item-text">Deskripsi</label>
                                <div class="list-group-item-heading">
                                    <textarea class="ckeditor" id="description" name="description"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--Image List-->
                    <div class="panel panel-default">
                        <div class="panel-heading clearfix">
                            <h3 class="panel-title pull-left">Daftar Gambar</h3>
                            <div class="btn-group pull-right"></div>
                        </div>
                        <div class="row" style="padding: 10px;" id="article-image-list"></div>
                    </div>
                </div>

                <div class="col-sm-4 bootcards-cards" id="content-right">
                    <!--Info-->
                    <div class="panel panel-default" style="margin-top: 10px;">
                        <div class="panel-heading clearfix">
                            <h3 class="panel-title pull-left" id="progress-info-basic">Informasi Artikel</h3>
                            <div class="pull-right">
                                <a class="btn btn-primary" href="javascript:void(0)" id="doPublish" style="display: none;">
                                    <i class="fa fa-floppy-o"></i>
                                    <span>Publikasikan</span>
                                </a>
                                <a class="btn btn-warning" href="javascript:void(0)" id="doUnpublish" style="display: none;">
                                    <i class="fa fa-floppy-o"></i>
                                    <span>Konsepkan</span>
                                </a>
                            </div>
                        </div>
                        <div class="list-group">
                            <div class="list-group-item">
                                <table style="border:0px;">
                                    <tr>
                                        <td><label class="list-group-item-text">Status</label></td>
                                        <td><label>&nbsp;&colon;&nbsp;</label></td>
                                        <td><label class="list-group-item-text" id="article-info-status"></label></td>
                                    </tr>
                                    <tr>
                                        <td><label class="list-group-item-text">Tanggal Dibuat</label></td>
                                        <td><label>&nbsp;&colon;&nbsp;</label></td>
                                        <td><label class="list-group-item-text" id="article-info-date"></label></td>
                                    </tr>
                                    <tr>
                                        <td><label class="list-group-item-text">Tanggal Diperbarui</label></td>
                                        <td><label>&nbsp;&colon;&nbsp;</label></td>
                                        <td><label class="list-group-item-text" id="article-info-date-update"></label>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="3" id="article-info-cover"></td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <div class="panel-footer">
                            <button class="btn btn-danger btn-block" id="doRemoveArticle">
                                <i class="fa fa-trash-o"></i>Hapus Artikel
                            </button>
                        </div>
                    </div>

                    <!--Menu-->
                    <div class="panel panel-default" style="margin-top: 10px;">
                        <div class="panel-heading clearfix">
                            <h3 class="panel-title pull-left" id="progress-info-menu">Input Menu</h3>
                            <div class="btn-group pull-right">
                                <a class="btn btn-success" href="javascript:void(0)" id="doSubmitArticleMenu">
                                    <i class="fa fa-floppy-o"></i>
                                    <span>Simpan</span>
                                </a>
                            </div>
                        </div>
                        <div class="list-group">
                            <div class="list-group-item">
                                <label class="list-group-item-text">Posisi</label>
                                <div class="list-group-item-heading">
                                    <select class="form-control" id="position">
                                        <option value="0">-- Pilih Posisi --</option>
                                        <option value="1">Atas</option>
                                        <option value="2">Bawah</option>
                                        <option value="3">Kanan</option>
                                        <option value="4">Kiri</option>
                                    </select>
                                </div>
                            </div>
                            <div class="list-group-item" style="border: 0px;">
                                <label class="list-group-item-text">Menu</label>
                                <div class="list-group-item-heading">
                                    <select class="form-control" id="menu-id"></select>
                                </div>
                            </div>
                            <input type="hidden" id="menu-name">
                        </div>
                        <div id="article-menu-list" style="margin: 0px 15px 15px 15px;"></div>
                    </div>

                    <!--Category-->
                    <div class="panel panel-default" style="margin-top: 10px;">
                        <div class="panel-heading clearfix">
                            <h3 class="panel-title pull-left" id="progress-info-category">Input Kategori</h3>
                            <div class="btn-group pull-right">
                                <a class="btn btn-success" href="javascript:void(0)" id="doSubmitArticleCategory">
                                    <i class="fa fa-floppy-o"></i>
                                    <span>Simpan</span>
                                </a>
                            </div>
                        </div>
                        <div class="list-group">
                            <div class="list-group-item" style="border: 0px;">
                                <label class="list-group-item-text">Kategori</label>
                                <div class="list-group-item-heading">
                                    <select class="form-control" id="category-list" name="category-list"></select>
                                </div>
                            </div>
                            <input type="hidden" id="category-title" name="category-title"/>
                        </div>
                        <div id="article-category-list" style="margin: 0px 15px 15px 15px;"></div>
                    </div>

                    <!--Label-->
                    <div class="panel panel-default" style="margin-top: 10px;">
                        <div class="panel-heading clearfix">
                            <h3 class="panel-title pull-left" id="progress-info-label">Input Label</h3>
                            <div class="btn-group pull-right">
                                <a class="btn btn-success" href="javascript:void(0)" id="doSubmitArticleLabel">
                                    <i class="fa fa-floppy-o"></i>
                                    <span>Simpan</span>
                                </a>
                            </div>
                        </div>
                        <div class="list-group">
                            <div class="list-group-item">
                                <label class="list-group-item-text">Label</label>
                                <div class="list-group-item-heading">
                                    <input type="text" name="label" id="label" class="form-control">
                                </div>
                            </div>
                        </div>
                        <div id="article-label-list" style="margin: 0px 15px 15px 15px;"></div>
                    </div>

                    <!--Upload Picture-->
                    <div class="panel panel-default" style="margin-top: 10px;">
                        <div class="panel-heading clearfix">
                            <h3 class="panel-title pull-left" id="progress-info-picture">Unggah Gambar</h3>
                            <div class="btn-group pull-right">
                                <a class="btn btn-success" href="javascript:void(0)" id="doUploadPicture">
                                    <i class="fa fa-upload"></i>
                                    <span>Unggah</span>
                                </a>
                            </div>
                        </div>
                        <div class="list-group">
                            <div class="list-group-item">
                                <label class="list-group-item-text">Judul</label>
                                <div class="list-group-item-heading">
                                    <input type="text" name="pic_title" id="pic_title" class="form-control">
                                </div>
                            </div>
                            <div class="list-group-item" style="border: 0px;">
                                <label class="list-group-item-text">Berkas PNG/JPG</label>
                                <div class="list-group-item-heading">
                                    <input type="file" name="fileToUpload" id="fileToUpload" class="form-control">
                                </div>
                            </div>
                            <span id="span-info" style="margin: 10px 10px 20px 15px;padding-bottom: 10px;"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--Footer & Navigation Bottom(Mobile)-->
        <div class="navbar navbar-default navbar-fixed-bottom" id="menu-bottom">
            <div class="container">
                <div class="bootcards-desktop-footer clearfix">
                    <p class="pull-left">2016 &copy; N-Portal Powered by NowDB</p>
                </div>
                <div class="btn-group">
                    <a href="javascript:void(0)" class="btn btn-default">
                        <i class="fa fa-2x fa-bars"></i>Menu 1
                    </a>
                    <a href="javascript:void(0)" class="btn btn-default active">
                        <i class="fa fa-2x fa-bars"></i>Menu 2
                    </a>
                    <a href="javascript:void(0)" class="btn btn-default">
                        <i class="fa fa-2x fa-bars"></i>Menu 3
                    </a>
                    <a href="javascript:void(0)" class="btn btn-default">
                        <i class="fa fa-2x fa-bars"></i>Menu 4
                    </a>
                    <a href="javascript:void(0)" class="btn btn-default">
                        <i class="fa fa-2x fa-bars"></i>Menu 5
                    </a>
                </div>
            </div>
        </div>

        <script src="plugin/ckeditor/ckeditor.js"></script>
        <script type="text/javascript">
            loginCheck();

            bootcards.init({
                offCanvasBackdrop: true,
                offCanvasHideOnMainClick: true,
                enableTabletPortraitMode: true,
                disableRubberBanding: true,
                disableBreakoutSelector: 'a.no-break-out'
            });

            isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

            window.addEventListener('load', function () {
                FastClick.attach(document.body);
            }, false);

            /*
             * Article
             */

            CKEDITOR.replace('description', {
                height: 400,
                language: 'id',
                toolbarGroups: [
                    {"name": "basicstyles", "groups": ["basicstyles"]},
                    {"name": "links", "groups": ["links"]},
                    {"name": "paragraph", "groups": ["list", "blocks"]},
                    {"name": "insert", "groups": ["insert"]},
                    {"name": "styles", "groups": ["styles"]}
                ]
            });

            CKEDITOR.on("instanceReady", function (event) {
                article_detail();
            });

            function article_detail() {
                var settings_article = {
                    "async": true,
                    "crossDomain": true,
                    "url": io + "v4/select_id" +
                    "/token/" + token +
                    "/project/" + project +
                    "/collection/article" +
                    "/appid/" + appid +
                    "/id/" + getParamValue('id'),
                    "method": "GET",
                    "headers": {
                        "cache-control": "no-cache"
                    }
                }

                $.ajax(settings_article).done(function (article) {
                    $('#title').val(article[0].title);
                    CKEDITOR.instances.description.setData(article[0].description);
                    if (article[0].status == '1') {
                        $('#doPublish').hide();
                        $('#doUnpublish').show();
                        $('#article-info-status').html("Terpublikasi");
                    } else {
                        $('#doPublish').show();
                        $('#doUnpublish').hide();
                        $('#article-info-status').html("Konsep");
                    }
                    $('#article-info-date').html(article[0].date);
                    $('#article-info-date-update').html(article[0].date_update);
                    if (article[0].cover != 0) {
                        $('#article-info-cover').html('<img src="' + io_file + article[0].cover + '" style="width: 100%;min-height: 150px;"/>');
                    }
                });
            }

            article_detail();

            $('#doUpdateArticle').click(function () {
                $('#progress-info-article').html('Loading..');

                for (instance in CKEDITOR.instances) {
                    CKEDITOR.instances[instance].updateElement();
                }

                var date = new Date();
                var today = date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear();

                var form_article_update = new FormData();
                form_article_update.append("token", token);
                form_article_update.append("project", project);
                form_article_update.append("collection", "article");
                form_article_update.append("appid", appid);
                form_article_update.append("title", $('#title').val());
                form_article_update.append("description", $('#description').val());
                form_article_update.append("date_update", today);
                form_article_update.append("id", getParamValue('id'));

                var settings_article_update = {
                    "async": true,
                    "crossDomain": true,
                    "url": io + "v4/update_id",
                    "method": "POST",
                    "headers": {
                        "cache-control": "no-cache",
                    },
                    "processData": false,
                    "contentType": false,
                    "mimeType": "multipart/form-data",
                    "data": form_article_update
                }

                $.ajax(settings_article_update).done(function (cb) {
                    $(location).attr('href', 'article_editor_index.html?id=' + getParamValue('id'));
                });
                return false;
            });

            $('#doPublish').click(function () {
                $('#progress-info-basic').html('Loading..');

                var id = getParamValue('id');

                var date = new Date();
                var today = date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear();

                var form_article_update = new FormData();
                form_article_update.append("token", token);
                form_article_update.append("project", project);
                form_article_update.append("collection", "article");
                form_article_update.append("appid", appid);
                form_article_update.append("status", 1);
                form_article_update.append("date_update", today);
                form_article_update.append("id", getParamValue('id'));

                var settings_article_update = {
                    "async": true,
                    "crossDomain": true,
                    "url": io + "v4/update_id",
                    "method": "POST",
                    "headers": {
                        "cache-control": "no-cache",
                    },
                    "processData": false,
                    "contentType": false,
                    "mimeType": "multipart/form-data",
                    "data": form_article_update
                }

                $.ajax(settings_article_update).done(function (cb) {
                    $(location).attr('href', 'article_editor_index.html?id=' + getParamValue('id'));
                });
                return false;
            });

            $('#doUnpublish').click(function () {
                $('#progress-info-basic').html('Loading..');

                var id = getParamValue('id');

                var date = new Date();
                var today = date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear();

                var form_article_update = new FormData();
                form_article_update.append("token", token);
                form_article_update.append("project", project);
                form_article_update.append("collection", "article");
                form_article_update.append("appid", appid);
                form_article_update.append("status", 0);
                form_article_update.append("date_update", today);
                form_article_update.append("id", getParamValue('id'));

                var settings_article_update = {
                    "async": true,
                    "crossDomain": true,
                    "url": io + "v4/update_id",
                    "method": "POST",
                    "headers": {
                        "cache-control": "no-cache",
                    },
                    "processData": false,
                    "contentType": false,
                    "mimeType": "multipart/form-data",
                    "data": form_article_update
                }

                $.ajax(settings_article_update).done(function (cb) {
                    $(location).attr('href', 'article_editor_index.html?id=' + getParamValue('id'));
                });
                return false;
            });

            $('#doRemoveArticle').click(function () {
                var id = $(this).attr('data-id');
                var status = confirm("Yakin akan menghapus data ini?");
                if (status == true) {
                    var article_category_remove = {
                        "async": true,
                        "crossDomain": true,
                        "url": io + "v4/remove_where" +
                        "/token/" + token +
                        "/project/" + project +
                        "/collection/article_category" +
                        "/appid/" + appid +
                        "/where_field/article_id" +
                        "/where_value/" + getParamValue('id'),
                        "method": "DELETE",
                        "headers": {
                            "cache-control": "no-cache"
                        }
                    }

                    $.ajax(article_category_remove).done();

                    var article_label_remove = {
                        "async": true,
                        "crossDomain": true,
                        "url": io + "v4/remove_where" +
                        "/token/" + token +
                        "/project/" + project +
                        "/collection/article_label" +
                        "/appid/" + appid +
                        "/where_field/article_id" +
                        "/where_value/" + getParamValue('id'),
                        "method": "DELETE",
                        "headers": {
                            "cache-control": "no-cache"
                        }
                    }

                    $.ajax(article_label_remove).done();

                    var article_image_remove = {
                        "async": true,
                        "crossDomain": true,
                        "url": io + "v4/remove_where" +
                        "/token/" + token +
                        "/project/" + project +
                        "/collection/article_image" +
                        "/appid/" + appid +
                        "/where_field/article_id" +
                        "/where_value/" + getParamValue('id'),
                        "method": "DELETE",
                        "headers": {
                            "cache-control": "no-cache"
                        }
                    }

                    $.ajax(article_image_remove).done();

                    var article_menu_remove = {
                        "async": true,
                        "crossDomain": true,
                        "url": io + "v4/remove_where" +
                        "/token/" + token +
                        "/project/" + project +
                        "/collection/menu_page" +
                        "/appid/" + appid +
                        "/where_field/content_id" +
                        "/where_value/" + getParamValue('id'),
                        "method": "DELETE",
                        "headers": {
                            "cache-control": "no-cache"
                        }
                    }

                    $.ajax(article_menu_remove).done(function () {
                        var article_remove = {
                            "async": true,
                            "crossDomain": true,
                            "url": io + "v4/remove_id" +
                            "/token/" + token +
                            "/project/" + project +
                            "/collection/article" +
                            "/appid/" + appid +
                            "/id/" + getParamValue('id'),
                            "method": "DELETE",
                            "headers": {
                                "cache-control": "no-cache"
                            }
                        }

                        $.ajax(article_remove).done(function () {
                            window.close();
                        });
                    });
                }
                return false;
            });

            /*
             * Label
             */

            function article_label_list() {
                var settings_article_label = {
                    "async": true,
                    "crossDomain": true,
                    "url": io + "v4/select_where" +
                    "/token/" + token +
                    "/project/" + project +
                    "/collection/article_label" +
                    "/appid/" + appid +
                    "/where_field/article_id" +
                    "/where_value/" + getParamValue('id'),
                    "method": "GET",
                    "headers": {
                        "cache-control": "no-cache"
                    }
                }

                $.ajax(settings_article_label).done(function (response_article_label) {
                    if (response_article_label.Data == '0') {
                        $('#article-label-list').empty();
                    } else {
                        $('#article-label-list').empty();
                        $.each(response_article_label, function (key, value) {
                            $('#article-label-list').append('<div class="btn-group" style="margin: 0px 10px 10px 0px;">' +
                                '<a class="btn btn-primary btn-xs"><i class="fa fa-tag"></i>' + value.label + '</a>' +
                                '<a class="btn btn-danger btn-xs" id="btn-remove-article-label" data-id="' + value.id + '">X</a>' +
                                '</div>');
                        });
                    }
                });
            }

            article_label_list();

            $('#doSubmitArticleLabel').click(function () {
                $('#progress-info-label').html('Loading..');

                var form_article_label = new FormData();
                form_article_label.append("token", token);
                form_article_label.append("project", project);
                form_article_label.append("collection", "article_label");
                form_article_label.append("appid", appid);
                form_article_label.append("article_id", getParamValue('id'));
                form_article_label.append("label", $('#label').val());

                var settings_article_label = {
                    "async": true,
                    "crossDomain": true,
                    "url": io + "v4/insert",
                    "method": "POST",
                    "headers": {
                        "cache-control": "no-cache",
                    },
                    "processData": false,
                    "contentType": false,
                    "mimeType": "multipart/form-data",
                    "data": form_article_label
                }

                $.ajax(settings_article_label).done(function (article_label) {
                    article_label_list();
                    $('#progress-info-label').html('Input Label');
                });
                return false;
            });

            $(document).off('click', '#btn-remove-article-label').on('click', '#btn-remove-article-label', function () {
                $('#progress-info-label').html('Loading..');

                var id = $(this).attr('data-id');

                var settings_article_label_remove = {
                    "async": true,
                    "crossDomain": true,
                    "url": io + "v4/remove_id" +
                    "/token/" + token +
                    "/project/" + project +
                    "/collection/article_label" +
                    "/appid/" + appid +
                    "/id/" + id,
                    "method": "DELETE",
                    "headers": {
                        "cache-control": "no-cache"
                    }
                }
                $.ajax(settings_article_label_remove).done(function (response_article_label_remove) {
                    article_label_list();
                    $('#progress-info-label').html('Input Label');
                });

                return false;
            });

            /*
             * Menu
             */

            $('#position').change(function () {
                $('#progress-info-menu').html('Loading..');

                var position = $(this).val();

                var settings_menu = {
                    "async": true,
                    "crossDomain": true,
                    "url": io + "v4/select_where" +
                    "/token/" + token +
                    "/project/" + project +
                    "/collection/menu" +
                    "/appid/" + appid +
                    "/where_field/position" +
                    "/where_value/" + position,
                    "method": "GET",
                    "headers": {
                        "cache-control": "no-cache"
                    }
                }

                $.ajax(settings_menu).done(function (response_menu) {
                    $('#progress-info-menu').html('Input Menu');

                    if (response_menu.Data == 0) {
                        $('#menu-id').empty();
                        $('#menu-id').append('<option value="0">-- Pilih Menu --</option>');
                    } else {
                        $('#menu-id').empty();
                        $('#menu-id').append('<option value="0">-- Pilih Menu --</option>');
                        $.each(response_menu, function (key, value) {
                            $('#menu-id').append('<option value="' + value.id + '" data-name="' + value.title + '">' + value.title + '</option>');
                        })
                    }
                });
                return false;
            });

            $(document).off('change', '#menu-id').on('change', '#menu-id', function () {
                var menu_name = $(this).find(':selected').attr('data-name');
                $('#menu-name').val(menu_name);
                return false;
            });

            $('#doSubmitArticleMenu').click(function () {
                $('#progress-info-menu').html('Loading..');

                var date = new Date();
                var today = date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear();

                var form_article_menu = new FormData();
                form_article_menu.append("token", token);
                form_article_menu.append("project", project);
                form_article_menu.append("collection", "menu_page");
                form_article_menu.append("appid", appid);
                form_article_menu.append("user_id", getUserInfo().user_id);
                form_article_menu.append("menu_id", $('#menu-id').val());
                form_article_menu.append("menu_name", $('#menu-name').val());
                form_article_menu.append("menu_position", $('#position').val());
                form_article_menu.append("content_id", getParamValue('id'));
                form_article_menu.append("content_title", $('#title').val());
                form_article_menu.append("content_type", 1);//1=article
                form_article_menu.append("date", today);


                var settings_article_menu = {
                    "async": true,
                    "crossDomain": true,
                    "url": io + "v4/insert",
                    "method": "POST",
                    "headers": {
                        "cache-control": "no-cache",
                    },
                    "processData": false,
                    "contentType": false,
                    "mimeType": "multipart/form-data",
                    "data": form_article_menu
                }

                $.ajax(settings_article_menu).done(function (response_article_menu) {
                    article_menu_list();
                    $('#progress-info-menu').html('Input Menu');
                });
                return false;
            });

            function article_menu_list() {
                var settings_article_menu = {
                    "async": true,
                    "crossDomain": true,
                    "url": io + "v4/select_where" +
                    "/token/" + token +
                    "/project/" + project +
                    "/collection/menu_page" +
                    "/appid/" + appid +
                    "/where_field/content_id" +
                    "/where_value/" + getParamValue('id'),
                    "method": "GET",
                    "headers": {
                        "cache-control": "no-cache"
                    }
                }

                $.ajax(settings_article_menu).done(function (response_article_menu) {
                    if (response_article_menu.Data == '0') {
                        $('#article-menu-list').empty();
                    } else {
                        $('#article-menu-list').empty();
                        $.each(response_article_menu, function (key, value) {
                            if (value.menu_position == 1) {
                                $('#article-menu-list').append('<div class="btn-group" style="margin: 0px 10px 10px 0px;">' +
                                    '<a class="btn btn-primary btn-xs">Atas : ' + value.menu_name + '</a>' +
                                    '<a class="btn btn-danger btn-xs" id="btn-remove-article-menu" data-id="' + value.id + '">X</a>' +
                                    '</div>');
                            } else if (value.menu_position == 2) {
                                $('#article-menu-list').append('<div class="btn-group" style="margin: 0px 10px 10px 0px;">' +
                                    '<a class="btn btn-primary btn-xs">Bawah : ' + value.menu_name + '</a>' +
                                    '<a class="btn btn-danger btn-xs" id="btn-remove-article-menu" data-id="' + value.id + '">X</a>' +
                                    '</div>');
                            } else if (value.menu_position == 3) {
                                $('#article-menu-list').append('<div class="btn-group" style="margin: 0px 10px 10px 0px;">' +
                                    '<a class="btn btn-primary btn-xs">Kanan : ' + value.menu_name + '</a>' +
                                    '<a class="btn btn-danger btn-xs" id="btn-remove-article-menu" data-id="' + value.id + '">X</a>' +
                                    '</div>');
                            } else if (value.menu_position == 4) {
                                $('#article-menu-list').append('<div class="btn-group" style="margin: 0px 10px 10px 0px;">' +
                                    '<a class="btn btn-primary btn-xs">Kiri : ' + value.menu_name + '</a>' +
                                    '<a class="btn btn-danger btn-xs" id="btn-remove-article-menu" data-id="' + value.id + '">X</a>' +
                                    '</div>');
                            }
                        });
                    }
                });
            }

            article_menu_list();

            $(document).off('click', '#btn-remove-article-menu').on('click', '#btn-remove-article-menu', function () {
                $('#progress-info-menu').html('Loading..');

                var id = $(this).attr('data-id');

                var settings_article_menu_remove = {
                    "async": true,
                    "crossDomain": true,
                    "url": io + "v4/remove_id" +
                    "/token/" + token +
                    "/project/" + project +
                    "/collection/menu_page" +
                    "/appid/" + appid +
                    "/id/" + id,
                    "method": "DELETE",
                    "headers": {
                        "cache-control": "no-cache"
                    }
                }
                $.ajax(settings_article_menu_remove).done(function (response_article_menu_remove) {
                    article_menu_list();
                    $('#progress-info-menu').html('Input Menu');
                });

                return false;
            });

            /*
             * Category
             */

            function category_list() {
                var settings_category = {
                    "async": true,
                    "crossDomain": true,
                    "url": io + "v4/select_all" +
                    "/token/" + token +
                    "/project/" + project +
                    "/collection/category" +
                    "/appid/" + appid,
                    "method": "GET",
                    "headers": {
                        "cache-control": "no-cache"
                    }
                }

                $.ajax(settings_category).done(function (response_category) {
                    if (response_category.Data == '0') {
                        $('#category-list').empty();
                        $('#category-list').append('<option value="0">-- Pilih Kategori --</option>');
                    } else {
                        $('#category-list').empty();
                        $('#category-list').append('<option value="0">-- Pilih Kategori --</option>');
                        $.each(response_category, function (key, value) {
                            $('#category-list').append('<option value="' + value.id + '" data-title="' + value.title + '">' + value.title + '</option>');
                        });
                    }
                });
            }

            category_list();

            $(document).off('change', '#category-list').on('change', '#category-list', function () {
                var category_title = $(this).find(':selected').attr('data-title');
                $('#category-title').val(category_title);
                return false;
            });

            $('#doSubmitArticleCategory').click(function () {
                $('#progress-info-category').html('Loading..');

                var form_article_category = new FormData();
                form_article_category.append("token", token);
                form_article_category.append("project", project);
                form_article_category.append("collection", "article_category");
                form_article_category.append("appid", appid);
                form_article_category.append("article_id", getParamValue('id'));
                form_article_category.append("category_id", $('#category-list').val());
                form_article_category.append("category_title", $('#category-title').val());

                var settings_article_category = {
                    "async": true,
                    "crossDomain": true,
                    "url": io + "v4/insert",
                    "method": "POST",
                    "headers": {
                        "cache-control": "no-cache",
                    },
                    "processData": false,
                    "contentType": false,
                    "mimeType": "multipart/form-data",
                    "data": form_article_category
                }

                $.ajax(settings_article_category).done(function (response_article_menu) {
                    article_category_list();
                    $('#progress-info-category').html('Input Kategori');
                });
                return false;
            });

            function article_category_list() {
                var settings_article_category = {
                    "async": true,
                    "crossDomain": true,
                    "url": io + "v4/select_where" +
                    "/token/" + token +
                    "/project/" + project +
                    "/collection/article_category" +
                    "/appid/" + appid +
                    "/where_field/article_id" +
                    "/where_value/" + getParamValue('id'),
                    "method": "GET",
                    "headers": {
                        "cache-control": "no-cache"
                    }
                }

                $.ajax(settings_article_category).done(function (response_article_category) {
                    if (response_article_category.Data == '0') {
                        $('#article-category-list').empty();
                    } else {
                        $('#article-category-list').empty();
                        $.each(response_article_category, function (key, value) {
                            $('#article-category-list').append('<div class="btn-group" style="margin: 0px 10px 10px 0px;">' +
                                '<a class="btn btn-primary btn-xs">' + value.category_title + '</a>' +
                                '<a class="btn btn-danger btn-xs" id="btn-remove-article-category" data-id="' + value.id + '">X</a>' +
                                '</div>');
                        });
                    }
                });
            }

            article_category_list();

            $(document).off('click', '#btn-remove-article-category').on('click', '#btn-remove-article-category', function () {
                $('#progress-info-category').html('Loading..');

                var id = $(this).attr('data-id');

                var settings_article_category_remove = {
                    "async": true,
                    "crossDomain": true,
                    "url": io + "v4/remove_id" +
                    "/token/" + token +
                    "/project/" + project +
                    "/collection/article_category" +
                    "/appid/" + appid +
                    "/id/" + id,
                    "method": "DELETE",
                    "headers": {
                        "cache-control": "no-cache"
                    }
                }
                $.ajax(settings_article_category_remove).done(function (response_article_category_remove) {
                    article_category_list();
                    $('#progress-info-category').html('Input Kategori');
                });

                return false;
            });

            /*
             * Gambar
             */

            $('#doUploadPicture').attr('disabled');

            function supportAjaxUploadWithProgress() {
                return supportFileAPI() && supportAjaxUploadProgressEvents() && supportFormData();
                // Is the File API supported?
                function supportFileAPI() {
                    var fi = document.createElement('INPUT');
                    fi.type = 'file';
                    return 'files' in fi;
                }

                // Are progress events supported?
                function supportAjaxUploadProgressEvents() {
                    var xhr = new XMLHttpRequest();
                    return !!(xhr && ('upload' in xhr) && ('onprogress' in xhr.upload));
                }

                // Is FormData supported?
                function supportFormData() {
                    return !!window.FormData;
                }
            }

            if (supportAjaxUploadWithProgress()) {
                $('#doUploadPicture').removeAttr('disabled');
                initFullFormAjaxUpload();
            }

            function initFullFormAjaxUpload() {
                $('#doUploadPicture').click(function () {
                    var formData = new (FormData);
                    formData.append("token", token);
                    formData.append("project", project);
                    // formData.append("fileToUpload", $('input[type=file]')[0].files[0]);
                    formData.append("fileToUpload", $('#fileToUpload')[0].files[0]);

                    var action = io + "files/uploader";

                    sendXHRequest(formData, action);
                    return false;
                });
            }

            function sendXHRequest(formData, uri) {
                $('#doUploadPicture').hide();
                var xhr = new XMLHttpRequest();
                xhr.upload.addEventListener('loadstart', onloadstartHandler, false);
                xhr.upload.addEventListener('progress', onprogressHandler, false);
                xhr.upload.addEventListener('load', onloadHandler, false);
                xhr.addEventListener('readystatechange', onreadystatechangeHandler, false);// Set up request
                xhr.open('POST', uri, true);
                xhr.send(formData);
            }

            function onloadstartHandler() {
                var spaninfo = document.getElementById('progress-info-picture');
                spaninfo.innerHTML = "Starting Process";
            }

            function onloadHandler() {
                var spaninfo = document.getElementById('progress-info-picture');
                spaninfo.innerHTML = "Finishing Process";
            }

            function onprogressHandler(callback) {
                var spaninfo = document.getElementById('progress-info-picture');
                var percent = Math.round(callback.loaded / callback.total * 100).toFixed(0);
                spaninfo.innerHTML = percent + " % Process";
            }

            function onreadystatechangeHandler(callback) {
                $('#doUploadPicture').show();
                if (callback.target.readyState == 4 && callback.target.status == '200' && callback.target.responseText) {
                    var spaninfo = document.getElementById('progress-info-picture');
                    spaninfo.innerHTML = "Processing Database";

                    var obj = $.parseJSON(callback.target.responseText);
                    var file = obj['filename'];

                    var date = new Date();
                    var today = date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear();

                    var form_article_image = new FormData();
                    form_article_image.append("token", token);
                    form_article_image.append("project", project);
                    form_article_image.append("collection", "article_image");
                    form_article_image.append("appid", appid);
                    form_article_image.append("user_id", getUserInfo().user_id);
                    form_article_image.append("article_id", getParamValue('id'));
                    form_article_image.append("title", $("#pic_title").val());
                    form_article_image.append("file", file);
                    form_article_image.append("date", today);

                    var settings_article_image = {
                        "async": true,
                        "crossDomain": true,
                        "url": io + "v4/insert",
                        "method": "POST",
                        "headers": {
                            "cache-control": "no-cache",
                        },
                        "processData": false,
                        "contentType": false,
                        "mimeType": "multipart/form-data",
                        "data": form_article_image
                    }

                    $.ajax(settings_article_image).done(function (response_article_image) {
                        article_image_list();
                        $('#progress-info-picture').html('Unggah Gambar');
                    });
                }
            }

            function article_image_list() {
                var settings_article_image = {
                    "async": true,
                    "crossDomain": true,
                    "url": io + "v4/select_where" +
                    "/token/" + token +
                    "/project/" + project +
                    "/collection/article_image" +
                    "/appid/" + appid +
                    "/where_field/article_id" +
                    "/where_value/" + getParamValue('id'),
                    "method": "GET",
                    "headers": {
                        "cache-control": "no-cache"
                    }
                }

                $.ajax(settings_article_image).done(function (response_article_image) {
                    if (response_article_image.Data == '0') {
                        $('#article-image-list').empty();
                    } else {
                        $('#article-image-list').empty();
                        $.each(response_article_image, function (key, value) {
                            $('#article-image-list').append('<div class="col-sm-6 col-md-4">' +
                                '<div class="thumbnail" style="height: 385px;">' +
                                '<div class="caption" style="padding-bottom: 0px;">' +
                                '<input id="url' + value.id + '" type="text" value="' + io_file + value.file + '" class="form-control">' +
                                '<span id="msg' + value.id + '"></span>' +
                                '<p>' +
                                '<a id="copyBtn' + value.id + '" class="btn btn-warning btn-xs" role="button" style="width: 100%;margin-top: 5px;"><i class="fa fa-link"></i> Link Copy</a>' +
                                '<a id="doSetCover" data-url="' + value.file + '" class="btn btn-primary btn-xs" role="button" style="width: 100%;margin-top: 5px;"><i class="fa fa-image"></i> Set Cover</a>' +
                                '<a id="doRemovePicture" data-id="' + value.id + '" class="btn btn-danger btn-xs" role="button" style="width: 100%;margin-top: 5px;"><i class="fa fa-trash"></i> Hapus</a>' +
                                '</p>' +
                                '<p>' + value.title + '</p>' +
                                '</div>' +
                                '<img src="' + io_file + value.file + '" style="padding: 0px 10px 10px 10px;width: 100%;">' +
                                '</div>' +
                                '</div>');

                            $('#copyBtn' + value.id).click(function () {
                                copyToClipboardMsg(document.getElementById("url" + value.id), "msg" + value.id);
                                return false;
                            });
                        });
                    }
                });
            }

            article_image_list();

            function copyToClipboardMsg(elem, msgElem) {
                var succeed = copyToClipboard(elem);
                var msg;
                if (!succeed) {
                    msg = "Copy not supported or blocked.  Press Ctrl+c to copy."
                } else {
                    msg = "URL Copied"
                }
                if (typeof msgElem === "string") {
                    msgElem = document.getElementById(msgElem);
                }
                msgElem.innerHTML = msg;
                setTimeout(function () {
                    msgElem.innerHTML = "";
                }, 1000);
            }

            function copyToClipboard(elem) {
                // create hidden text element, if it doesn't already exist
                var targetId = "_hiddenCopyText_";
                var isInput = elem.tagName === "INPUT" || elem.tagName === "TEXTAREA";
                var origSelectionStart, origSelectionEnd;
                if (isInput) {
                    // can just use the original source element for the selection and copy
                    target = elem;
                    origSelectionStart = elem.selectionStart;
                    origSelectionEnd = elem.selectionEnd;
                } else {
                    // must use a temporary form element for the selection and copy
                    target = document.getElementById(targetId);
                    if (!target) {
                        var target = document.createElement("textarea");
                        target.style.position = "absolute";
                        target.style.left = "-9999px";
                        target.style.top = "0";
                        target.id = targetId;
                        document.body.appendChild(target);
                    }
                    target.textContent = elem.textContent;
                }
                // select the content
                var currentFocus = document.activeElement;
                target.focus();
                target.setSelectionRange(0, target.value.length);

                // copy the selection
                var succeed;
                try {
                    succeed = document.execCommand("copy");
                } catch (e) {
                    succeed = false;
                }
                // restore original focus
                if (currentFocus && typeof currentFocus.focus === "function") {
                    currentFocus.focus();
                }

                if (isInput) {
                    // restore prior selection
                    elem.setSelectionRange(origSelectionStart, origSelectionEnd);
                } else {
                    // clear temporary content
                    target.textContent = "";
                }
                return succeed;
            }

            $(document).off('click', '#doRemovePicture').on('click', '#doRemovePicture', function () {
                var id = $(this).attr('data-id');
                var status = confirm("Yakin akan menghapus data ini?");
                if (status == true) {
                    var settings_article_image_remove = {
                        "async": true,
                        "crossDomain": true,
                        "url": io + "v4/remove_id" +
                        "/token/" + token +
                        "/project/" + project +
                        "/collection/article_image" +
                        "/appid/" + appid +
                        "/id/" + id,
                        "method": "DELETE",
                        "headers": {
                            "cache-control": "no-cache"
                        }
                    }

                    $.ajax(settings_article_image_remove).done(function (response_article_image_remove) {
                        article_image_list();
                    });
                }
                return false;
            });

            $(document).off('click', '#doSetCover').on('click', '#doSetCover', function () {
                var file = $(this).attr('data-url');
                var status = confirm("Jadikan gambar ini sebagai cover artikel?");
                if (status == true) {
                    var form_cover_update = new FormData();
                    form_cover_update.append("token", token);
                    form_cover_update.append("project", project);
                    form_cover_update.append("collection", "article");
                    form_cover_update.append("appid", appid);
                    form_cover_update.append("id", getParamValue('id'));
                    form_cover_update.append("cover", file);

                    var settings_cover_update = {
                        "async": true,
                        "crossDomain": true,
                        "url": io + "v4/update_id",
                        "method": "POST",
                        "headers": {
                            "cache-control": "no-cache",
                        },
                        "processData": false,
                        "contentType": false,
                        "mimeType": "multipart/form-data",
                        "data": form_cover_update
                    }

                    $.ajax(settings_cover_update).done(function () {
                        $(location).attr('href', 'article_editor_index.html?id=' + getParamValue('id'));
                    });
                }
                return false;
            });
        </script>
    </body>
</html>